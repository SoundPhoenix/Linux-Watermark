#!/Bin/bash
set -e
echo -e "/e[32m
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#           Tanner's Watermark Setup Script             #
#       This Script only works on Ubuntu & Debian       #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # #e[0m"

#Make sure the user is sudo
if [ "$EUID" -ne 0 ]; then
    echo "This script must be run as a sudo user"
    exit 1
fi

#Check if user is sudo
if [ "$EUID" -ne 0 ]; then
    echo "This script must be run with sudo."
    exit 1
fi

# Check if the OS is Debian or Ubuntu
if [ -f /etc/os-release ]; then
    . /etc/os-release
    if [[ "$ID" != "debian" && "$ID" != "ubuntu" ]]; then
        echo "This script is intended for Debian or Ubuntu only."
        exit 1
    fi
else
    echo "Unable to determine the operating system."
    exit 1
fi

# Proceed?
while true; do
    RESET="\e[0m"
    GREEN="\e[32m"
    read -p "$(echo -e $GREEN"\n* Continue? (Y/N)"$RESET)" yn
    case $yn in
        [yY] ) echo -e "\e[32m* Confirmed. Continuing installation..\e[0m"; break;;
        [nN] ) echo -e "\e[32m* Confirmed. Exiting Installation..\e[0m"; exit;;
        * ) echo -e "\e[32m* Invalid Response.\e[0m";;
    esac
done

echo -e "\e[32m* Setting up watermark..\e[0m"
awk '/^#?Banner/{gsub(/#?Banner .*/, "Banner /etc/welcome"); found=1}1;END{if(!found) print "Banner /etc/welcome"}' /etc/ssh/sshd_config > /tmp/sshd_config_temp && sudo mv /tmp/sshd_config_temp /etc/ssh/sshd_config

echo -e "\n* Enter your domain (e.g., example.com):"
read -r host

# Setup MOTD
if [[ -f /etc/motd ]]; then
    echo -e "\e[32m* /etc/motd file found. Removing file..\e[0m"
    rm /etc/motd
else
    echo -e "\e[32m* /etc/motd file not found. Skipping removal.\e[0m"
fi

cat <<EOL | sudo tee -a /etc/motd > /dev/null
__/\\\\\\\\\\\\\\\_______________________________________________________________________________________/\\\\\\\\\\\___        
 _\///////\\\/////______________________________________________________________________________________/\\\/////////\\\_       
  _______\/\\\__________________________________________________________________________________________\//\\\______\///__      
   _______\/\\\________/\\\\\\\\\_____/\\/\\\\\\____/\\/\\\\\\_______/\\\\\\\\___/\\/\\\\\\\______________\////\\\_________     
    _______\/\\\_______\////////\\\___\/\\\////\\\__\/\\\////\\\____/\\\/////\\\_\/\\\/////\\\________________\////\\\______    
     _______\/\\\_________/\\\\\\\\\\__\/\\\__\//\\\_\/\\\__\//\\\__/\\\\\\\\\\\__\/\\\___\///____________________\////\\\___   
      _______\/\\\________/\\\/////\\\__\/\\\___\/\\\_\/\\\___\/\\\_\//\\///////___\/\\\____________________/\\\______\//\\\__  
       _______\/\\\_______\//\\\\\\\\/\\_\/\\\___\/\\\_\/\\\___\/\\\__\//\\\\\\\\\\_\/\\\___________________\///\\\\\\\\\\\/___ 
        _______\///_________\////////\//__\///____\///__\///____\///____\//////////__\///______________________\///////////_____
__/\\\\\_____/\\\__________________________________________________________________________________________                     
 _\/\\\\\\___\/\\\_____________________________________________________________________________/\\\_________                    
  _\/\\\/\\\__\/\\\____________________/\\\____________________________________________________\/\\\_________                   
   _\/\\\//\\\_\/\\\_____/\\\\\\\\___/\\\\\\\\\\\__/\\____/\\___/\\_____/\\\\\_____/\\/\\\\\\\__\/\\\\\\\\____                  
    _\/\\\\//\\\\/\\\___/\\\/////\\\_\////\\\////__\/\\\__/\\\\_/\\\___/\\\///\\\__\/\\\/////\\\_\/\\\////\\\__                 
     _\/\\\_\//\\\/\\\__/\\\\\\\\\\\_____\/\\\______\//\\\/\\\\\/\\\___/\\\__\//\\\_\/\\\___\///__\/\\\\\\\\/___                
      _\/\\\__\//\\\\\\_\//\\///////______\/\\\_/\\___\//\\\\\/\\\\\___\//\\\__/\\\__\/\\\_________\/\\\///\\\___               
       _\/\\\___\//\\\\\__\//\\\\\\\\\\____\//\\\\\_____\//\\\\//\\\_____\///\\\\\/___\/\\\_________\/\\\_\///\\\_              
        _\///_____\/////____\//////////______\/////_______\///__\///________\/////_____\///__________\///____\///__   

#########################################################################################
# WARNING: ANY UNAUTHORIZED ACCESS WILL BE LOGGED AND REPORTED TO AUTHORITIES IF NEEDED #          
#########################################################################################  

This server is managed by: Tanner Schermerhorn (tannerschermerhorn.dev)

Node ID: $host

Contact me: me@tannerschermerhorn.dev

EOL

if [[ -f /etc/welcome ]]; then
    echo -e "\e[32m* /etc/welcome file found. Removing file..\e[0m"
    rm /etc/welcome
else
    echo -e "\e[32m* /etc/welcome file not found. Skipping removal.\e[0m"
fi

cat <<EOL | sudo tee -a /etc/welcome > /dev/null
__/\\\\\\\\\\\\\\\_______________________________________________________________________________________/\\\\\\\\\\\___        
 _\///////\\\/////______________________________________________________________________________________/\\\/////////\\\_       
  _______\/\\\__________________________________________________________________________________________\//\\\______\///__      
   _______\/\\\________/\\\\\\\\\_____/\\/\\\\\\____/\\/\\\\\\_______/\\\\\\\\___/\\/\\\\\\\______________\////\\\_________     
    _______\/\\\_______\////////\\\___\/\\\////\\\__\/\\\////\\\____/\\\/////\\\_\/\\\/////\\\________________\////\\\______    
     _______\/\\\_________/\\\\\\\\\\__\/\\\__\//\\\_\/\\\__\//\\\__/\\\\\\\\\\\__\/\\\___\///____________________\////\\\___   
      _______\/\\\________/\\\/////\\\__\/\\\___\/\\\_\/\\\___\/\\\_\//\\///////___\/\\\____________________/\\\______\//\\\__  
       _______\/\\\_______\//\\\\\\\\/\\_\/\\\___\/\\\_\/\\\___\/\\\__\//\\\\\\\\\\_\/\\\___________________\///\\\\\\\\\\\/___ 
        _______\///_________\////////\//__\///____\///__\///____\///____\//////////__\///______________________\///////////_____
__/\\\\\_____/\\\__________________________________________________________________________________________                     
 _\/\\\\\\___\/\\\_____________________________________________________________________________/\\\_________                    
  _\/\\\/\\\__\/\\\____________________/\\\____________________________________________________\/\\\_________                   
   _\/\\\//\\\_\/\\\_____/\\\\\\\\___/\\\\\\\\\\\__/\\____/\\___/\\_____/\\\\\_____/\\/\\\\\\\__\/\\\\\\\\____                  
    _\/\\\\//\\\\/\\\___/\\\/////\\\_\////\\\////__\/\\\__/\\\\_/\\\___/\\\///\\\__\/\\\/////\\\_\/\\\////\\\__                 
     _\/\\\_\//\\\/\\\__/\\\\\\\\\\\_____\/\\\______\//\\\/\\\\\/\\\___/\\\__\//\\\_\/\\\___\///__\/\\\\\\\\/___                
      _\/\\\__\//\\\\\\_\//\\///////______\/\\\_/\\___\//\\\\\/\\\\\___\//\\\__/\\\__\/\\\_________\/\\\///\\\___               
       _\/\\\___\//\\\\\__\//\\\\\\\\\\____\//\\\\\_____\//\\\\//\\\_____\///\\\\\/___\/\\\_________\/\\\_\///\\\_              
        _\///_____\/////____\//////////______\/////_______\///__\///________\/////_____\///__________\///____\///__   

#########################################################################################
# WARNING: ANY UNAUTHORIZED ACCESS WILL BE LOGGED AND REPORTED TO AUTHORITIES IF NEEDED #          
#########################################################################################  
                                                                                                                                                          
This server is managed by: Tanner Schermerhorn (tannerschermerhorn.dev)

Node ID: $host

Contact me: me@tannerschermerhorn.dev

EOL

# Restart SSH
sudo systemctl restart ssh

rm /etc/hostname

cat <<EOL | sudo tee -a /etc/hostname > /dev/null
$host
EOL
echo -e "\e[32m* Domain setup completed\e[0m"
